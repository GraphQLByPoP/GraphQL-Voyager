<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <script src="https://cdn.jsdelivr.net/npm/react@16/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@16/umd/react-dom.production.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/graphql-voyager/dist/voyager.css" />
    <script src="https://cdn.jsdelivr.net/npm/graphql-voyager/dist/voyager.min.js"></script>
  </head>
  <body>
    <div id="voyager">Loading...</div>
    <script>
      /*
       * Converts a string to a bool.
       *
       * This conversion will:
       *
       *  - match 'true', 'on', or '1' as true.
       *  - ignore all white-space padding
       *  - ignore capitalization (case).
       *
       * '  tRue  ','ON', and '1   ' will all evaluate as true.
       *
       * Taken from https://stackoverflow.com/a/264180
       * 
       */
      function strToBool(s)
      {
          // will match one and only one of the string 'true','1', or 'on' rerardless
          // of capitalization and regardless off surrounding white-space.
          //
          regex=/^\s*(true|1|on)\s*$/i
          return regex.test(s);
      }
      var search = window.location.search;
      var parameters = {};
      search
        .substr(1)
        .split('&')
        .forEach(function(entry) {
          var eq = entry.indexOf('=');
          if (eq >= 0) {
            parameters[decodeURIComponent(entry.slice(0, eq))] = decodeURIComponent(
              entry.slice(eq + 1),
            );
          }
        });
      let apiURL = window.location.origin + '/api/graphql/';
      // Copy parameters
      if (parameters.use_namespace && strToBool(parameters.use_namespace)) {
        apiURL += '?use_namespace=true';
      }
      function introspectionProvider(query) {
        return fetch(apiURL, {
          method: 'post',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({query: query}),
        }).then(response => response.json());
      }

      // Render <Voyager />
      GraphQLVoyager.init(document.getElementById('voyager'), {
        introspection: introspectionProvider
      })
    </script>
  </body>
</html>